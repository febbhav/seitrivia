<!-- Add this modal to your admin.html, right before the closing </body> tag -->

<!-- Reset User Password Modal -->
<div class="modal-overlay" id="resetPasswordModal">
    <div class="modal">
        <div class="modal-header">
            <h2>Reset User Password</h2>
            <button class="modal-close" id="closeResetPasswordModal">×</button>
        </div>
        <div class="modal-body">
            <div class="error-message" id="resetPasswordError"></div>
            <div class="success-message" id="resetPasswordSuccess"></div>

            <div class="input-group">
                <label for="resetPasswordEmail">User Email</label>
                <input type="email" id="resetPasswordEmail" disabled>
            </div>

            <div class="input-group">
                <label for="resetPasswordUserId">User ID</label>
                <input type="text" id="resetPasswordUserId" disabled>
            </div>

            <div class="input-group">
                <label for="resetPasswordNew">New Password</label>
                <input type="text" id="resetPasswordNew" placeholder="Enter new password (min 6 characters)">
                <span class="help-text">⚠️ This will allow you to login as this user</span>
            </div>

            <div class="input-group">
                <label>
                    <input type="checkbox" id="resetPasswordConfirm">
                    I understand this will change the user's password and allow me to login as them
                </label>
            </div>

            <button class="btn" id="executeResetPasswordBtn">Reset Password</button>
        </div>
    </div>
</div>

<style>
/* Add any additional styles needed */
.help-text {
    color: #ED1B2E;
    font-weight: 600;
}
</style>

<script>
// Add this JavaScript to your admin.js file

// DOM elements for password reset modal
const resetPasswordModal = document.getElementById('resetPasswordModal');
const closeResetPasswordModal = document.getElementById('closeResetPasswordModal');
const resetPasswordEmail = document.getElementById('resetPasswordEmail');
const resetPasswordUserId = document.getElementById('resetPasswordUserId');
const resetPasswordNew = document.getElementById('resetPasswordNew');
const resetPasswordConfirm = document.getElementById('resetPasswordConfirm');
const executeResetPasswordBtn = document.getElementById('executeResetPasswordBtn');
const resetPasswordError = document.getElementById('resetPasswordError');
const resetPasswordSuccess = document.getElementById('resetPasswordSuccess');

let currentResetUserId = null;
let currentResetUserEmail = null;

// Close modal handlers
closeResetPasswordModal.addEventListener('click', () => {
    resetPasswordModal.classList.remove('active');
});

// Function to open password reset modal
function openResetPasswordModal(userId, userEmail) {
    currentResetUserId = userId;
    currentResetUserEmail = userEmail;
    
    resetPasswordEmail.value = userEmail;
    resetPasswordUserId.value = userId;
    resetPasswordNew.value = '';
    resetPasswordConfirm.checked = false;
    
    resetPasswordModal.classList.add('active');
}

// Execute password reset
executeResetPasswordBtn.addEventListener('click', async () => {
    const newPassword = resetPasswordNew.value.trim();
    
    if (!newPassword) {
        showError('Please enter a new password', resetPasswordError);
        return;
    }
    
    if (newPassword.length < 6) {
        showError('Password must be at least 6 characters', resetPasswordError);
        return;
    }
    
    if (!resetPasswordConfirm.checked) {
        showError('Please confirm you understand this action', resetPasswordError);
        return;
    }
    
    try {
        executeResetPasswordBtn.disabled = true;
        executeResetPasswordBtn.textContent = 'Resetting...';
        
        // Call Firebase Cloud Function to reset password
        const resetPasswordFunction = httpsCallable(functions, 'adminResetPassword');
        const result = await resetPasswordFunction({
            userId: currentResetUserId,
            newPassword: newPassword
        });
        
        showSuccess(`Password reset successfully! You can now login with:\nEmail: ${currentResetUserEmail}\nPassword: ${newPassword}`, resetPasswordSuccess);
        
        resetPasswordNew.value = '';
        resetPasswordConfirm.checked = false;
        
    } catch (error) {
        showError('Error: ' + error.message + '\n\nNote: This requires a Firebase Cloud Function. See PASSWORD_RESET_SETUP.md', resetPasswordError);
    } finally {
        executeResetPasswordBtn.disabled = false;
        executeResetPasswordBtn.textContent = 'Reset Password';
    }
});

// Modify the displayUsers function to add a "Reset Password" button
// Find this section in your existing admin.js and add the button:

/* 
In the displayUsers() function, add this button to the actions div:

<button class="btn btn-small" onclick="openResetPasswordModal('${u.id}', '${u.email}')">Reset Password</button>

Full example:
userItem.innerHTML = `
    ... existing code ...
    <div class="actions">
        <button class="btn btn-small edit-user-btn" data-id="${u.id}">Edit Profile</button>
        <button class="btn btn-small" onclick="openResetPasswordModal('${u.id}', '${u.email}')">Reset Password</button>
    </div>
`;
*/
</script>
